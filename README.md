# JSTP / JavaScript Transfer Protocol

## Концепция

Это семейство форматов данных и соответствующих библиотек для работы с ними,
которые основаны на нескольких простых допущениях:
* передавать данные в виде JavaScript кода можно красивее и удобнее, чем в
формате сериализации JavaScript объектов JSON; и это даже не потребует
специального парсера, т.к. он уже встроен в передающую и принимающую системы;
* передавать структуру вместе с данными каждый раз - это избыточно и нужно
оптимизировать формат сериализации и протокол, выделив метамодель и передавать
ее только если получающая система еще не имеет закешированной версии
метамодели;
* протокол взаимодействия между двумя JavaScript приложениями должен обладать
такими характеристиками: 
  - двусторонний асинхронный обмен данными с поддержкой множества параллельных
  (не блокирующих) взаимодействий и идентификаторов пакетов, позволяющих,
  например, установить соответствие между запросом и ответом;
  - поддержка вызова удаленных процедур RPC с поддержкой множественных API
  интерфейсов должна быть настолько прозрачна, что приложения не должны знать,
  происходит ли вызов внутри адресного пространства приложения или передан на
  удаленную систему для исполнения;
  - поддержка как прямого ответа от метода RPC API, так и ответа по обратному
  вызову `callback`;
  - поддержка трансляции именованных событий прикрепленными к ним данными и
  именованных каналов для группировки событий;
  - поддержка автоматической синхронизации объектов в памяти приложений,
  специально зарегистрированы для синхронизации;
  - только одна из сторон может стать инициатором соединения, но обе стороны
  могут инициировать обмен данными по уже открытому каналу;
  - транспортный уровень должен обеспечивать надежную передачу данных с
  установкой соединения и гарантированной доставкой (TCP базовый транспорт, но
  мы не ограничиваемся им и может быть использован аналог для передачи данных
  через RS232, USB или Websocket);
  - все типы пакетов (вызов, ответ, колбэек, событие и данные) могут быть
  разделены на несколько частей, если тело прикрепленных данных слишком большое;
  - необходима возможность прекратить передачу данных, если данные, передаваемые
  по частям, слишком большие и еще не получена последняя их часть;
* передача данных в JavaScript может быть не менее безопасна, чем в JSON, даже
с учетом возможности передачи тела функций или выражений, содержащих вызовы
функций, потому, что их исполнение на удаленной стороне происходит в песочницах
и протокол должен иметь специальные механизмы обеспечения безопасности;
* необходимо минимизировать преобразование данных при передаче между системами,
хранении и обработке, минимизировать перекладывание из одних структур в другие,
экономить память и канал связи;
* количество структур данных, необходимых для работы большинства систем является
конечным, а сами структуры должны стать фактическими стандартами в результате
консенсуса специалистов с возможностью их версионного изменения;
* не стандартизированные структуры данных могут передаваться между системами,
снабженные метаданными, которые позволяют их интерпретировать и до известной
степени обеспечить универсальную обработку, если удаленные стороны доверяют друг
другу, а формализация данных не имеет смысла;

## Структура семейства форматов

* JSRS / JavaScript Record Serialization / *.jsrs files
* JSRM / JavaScript Record Metadata / *.jsrm files
* JSRD / JavaScript Record Data / *.jsrd files
* JSTP / JavaScript Transfer Protocol / *.jstp files
